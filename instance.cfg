[buildout]
extends = 
    base.cfg?login=bsuttor&token=9520b5a9dd1ddc6f0cfea557f76e32bc
parts =
    lxml
    instance
    zopepy
    varnish
    varnish-conf
    supervisor
    supervisord-initd
    omelette

[supervisor]
client =
    20 instance ${buildout:directory}/bin/instance [console] ${instance:location}
    30 varnish ${command:varnish-daemon} [ -f ${buildout:directory}/etc/varnish.vcl -n ${buildout:directory}/var -s malloc,1G -a ${hosts:varnish}:${ports:varnish} -F ] ${buildout:directory} 
programs =
    ${supervisor:client}

[varnish-conf]
recipe = collective.recipe.template
url = ${urls:buildout-repository}/templates/varnish.vcl
output = ${buildout:directory}/etc/varnish.vcl
backend_client1 = ${hosts:varnish-backend1}
backend_client1_port = ${ports:instance}
